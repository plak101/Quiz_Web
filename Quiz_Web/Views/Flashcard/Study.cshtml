@model List<Quiz_Web.Models.Entities.Flashcard>
@{
    ViewData["Title"] = "Flashcards";
    Layout = "~/Views/Shared/_LayoutFlashcards.cshtml";
}

@section Styles {
    <link rel="stylesheet" href="~/css/flashcards/common.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/flashcards/index.css" asp-append-version="true" />
}

@if (Model == null || !Model.Any())
{
    <div class="flashcard-container">
        <div class="empty-state">
            <h2 class="text-white">@ViewBag.SetTitle</h2>
            <p class="text-white-50">This flashcard set has no cards yet.</p>
            <a href="@Url.Action("Index", "Home")" class="btn btn-outline-light mt-3">
                <i class="bi bi-house-door me-2"></i>Back to Home
            </a>
        </div>
    </div>
}
else
{
    <div class="flashcard-container">
        <!-- Header v?i progress bar và coin -->
        <div class="flashcard-header">
            <div class="progress-section">
                <div class="progress" style="width: 200px; height: 8px;">
                    <div class="progress-bar bg-info" id="progressFill" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <span class="progress-text text-white fw-medium ms-3" id="progressText">0%</span>
            </div>
        </div>

        <!-- Counter section -->
        <div class="flashcard-counter mb-4">
            <span class="text-white fs-5 fw-medium" id="cardCounter">1 / @ViewBag.TotalCards Flashcards</span>
        </div>

        <!-- Flashcard -->
        <div class="flashcard-wrapper d-flex align-items-center justify-content-center gap-4">
            <button class="btn btn-outline-light rounded-circle nav-btn" id="prevBtn" onclick="previousCard()" disabled>
                <i class="bi bi-chevron-left"></i>
            </button>
            
            <div class="flashcard" id="flashcard">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <div class="card-content p-4">
                            <p class="text-white fs-4 mb-0" id="frontText">Loading...</p>
                        </div>
                    </div>
                    <div class="flashcard-back">
                        <div class="card-content p-4">
                            <p class="text-white fs-4 mb-0" id="backText">Loading...</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <button class="btn btn-outline-light rounded-circle nav-btn" id="nextBtn" onclick="nextCard()">
                <i class="bi bi-chevron-right"></i>
            </button>
        </div>

        <!-- Instructions -->
        <div class="instructions text-center mt-4">
            <p class="text-white-50 small">
                Nhấn vào flashcard hoặc gõ phím <kbd class="bg-white bg-opacity-20 text-black px-2 py-1 rounded">Space</kbd> để lật
            </p>
        </div>

        <!-- Complete Button (Hidden by default) -->
        <div class="complete-section mb-3" id="completeSection" style="display: none;">
            <button class="btn btn-success btn-lg rounded-pill px-5 shadow" id="btnComplete" onclick="goToFinish()">
                <i class="bi bi-check-circle me-2"></i>
                Hoàn thành
            </button>
        </div>

        <!-- Avatar section -->
        <div class="position-absolute bottom-0 start-0 m-4 d-flex align-items-center gap-3">
            <div class="avatar">
                <img src="https://via.placeholder.com/50x50/4CAF50/ffffff?text=D" alt="Avatar" 
                     class="rounded-circle border border-2 border-white border-opacity-25" 
                     width="50" height="50" />
            </div>
            <div class="avatar-info">
                <p class="text-white fw-semibold mb-0">Dung</p>
                <p class="text-white-50 small mb-0">Duy</p>
            </div>
        </div>
    </div>

    @section Scripts {
        <script src="~/js/flashcards/index.js" asp-append-version="true"></script>
        <script>
            // Initialize flashcards data
            const flashcardsData = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Select(f => new { 
                FrontText = f.FrontText ?? "", 
                BackText = f.BackText ?? "" 
            }).ToList()));
            
            const setId = @ViewBag.SetId;
            
            console.log('Flashcards data:', flashcardsData);
            console.log('Total cards:', @ViewBag.TotalCards);
            
            if (typeof initializeFlashcards === 'function') {
                initializeFlashcards(flashcardsData, @ViewBag.TotalCards, setId);
            } else {
                console.error('initializeFlashcards function not found');
            }
        </script>
    }
}
