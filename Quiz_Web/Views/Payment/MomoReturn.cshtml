@{
    ViewData["Title"] = "Kết quả thanh toán";
    var resultCode = ViewBag.ResultCode as string;
    var message = ViewBag.Message as string;
    var orderId = ViewBag.OrderId as string;
    var amount = ViewBag.Amount as string;
    var transId = ViewBag.TransId as string;
    var isSuccess = resultCode == "0";

    // Parse amount safely for display
    decimal amt = 0;
    if (!string.IsNullOrEmpty(amount))
    {
        decimal.TryParse(amount, out amt);
    }
}

<div class="payment-result-container">
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-6 col-md-8">
                <div class="card shadow-lg">
                    <div class="card-body text-center p-5">
                        @if (isSuccess)
                        {
                            <div class="success-animation mb-4">
                                <i class="bi bi-check-circle-fill text-success" style="font-size: 100px;"></i>
                            </div>
                            <h2 class="text-success mb-3">Thanh toán thành công!</h2>
                            <p class="text-muted mb-4">
                                Cảm ơn bạn đã mua hàng. Đơn hàng của bạn đã được xử lý thành công.
                            </p>
                        }
                        else
                        {
                            <div class="error-animation mb-4">
                                <i class="bi bi-x-circle-fill text-danger" style="font-size: 100px;"></i>
                            </div>
                            <h2 class="text-danger mb-3">Thanh toán thất bại!</h2>
                            <p class="text-muted mb-4">
                                @message
                            </p>
                        }

                        <div class="transaction-details bg-light p-4 rounded mb-4 text-start">
                            <h5 class="mb-3">Thông tin giao dịch</h5>
                            <div class="row mb-2">
                                <div class="col-6 text-muted">Mã đơn hàng:</div>
                                <div class="col-6 text-end"><strong>@orderId</strong></div>
                            </div>
                            @if (!string.IsNullOrEmpty(transId))
                            {
                                <div class="row mb-2">
                                    <div class="col-6 text-muted">Mã giao dịch:</div>
                                    <div class="col-6 text-end"><strong>@transId</strong></div>
                                </div>
                            }
                            @if (!string.IsNullOrEmpty(amount))
                            {
                                <div class="row mb-2">
                                    <div class="col-6 text-muted">Số tiền:</div>
                                    <div class="col-6 text-end"><strong>@(amt > 0 ? amt.ToString("N0") + " ₫" : amount)</strong></div>
                                </div>
                            }
                            <div class="row">
                                <div class="col-6 text-muted">Thời gian:</div>
                                <div class="col-6 text-end"><strong>@DateTime.Now.ToString("dd/MM/yyyy HH:mm")</strong></div>
                            </div>
                        </div>

                        <div class="d-grid gap-2">
                            @if (isSuccess)
                            {
                                <a href="=@Url.Action("Index","Library")" class="btn btn-success btn-lg">
                                    <i class="bi bi-book me-2"></i>Xem khóa học của tôi
                                </a>
                                <a href="/courses" class="btn btn-outline-primary">
                                    <i class="bi bi-arrow-left me-2"></i>Tiếp tục mua sắm
                                </a>
                            }
                            else
                            {
                                <a href="/checkout" class="btn btn-primary btn-lg">
                                    <i class="bi bi-arrow-clockwise me-2"></i>Thử lại
                                </a>
                                <a href="/courses" class="btn btn-outline-secondary">
                                    <i class="bi bi-house me-2"></i>Về trang chủ
                                </a>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .payment-result-container {
        min-height: 100vh;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 40px 0;
    }

    .success-animation i,
    .error-animation i {
        animation: scaleIn 0.5s ease-in-out;
    }

    @@keyframes scaleIn {
        0% {
            transform: scale(0);
            opacity: 0;
        }
        50% {
            transform: scale(1.1);
        }
        100% {
            transform: scale(1);
            opacity: 1;
        }
    }
</style>
