@model Quiz_Web.Models.ViewModels.SystemActivityViewModel
@{
    ViewData["Title"] = "Hoạt động và hệ thống";
    Layout = "_LayoutAdmin";
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h2>Hoạt động và hệ thống</h2>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="@Url.Action("Index", "Admin")">Dashboard</a></li>
                    <li class="breadcrumb-item active">Hoạt động hệ thống</li>
                </ol>
            </nav>
        </div>
    </div>

    <!-- Summary Cards -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <h4>@Model.TotalLogins</h4>
                    <p class="mb-0">Tổng lượt đăng nhập (30 ngày)</p>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card bg-danger text-white">
                <div class="card-body">
                    <h4>@Model.SystemErrors</h4>
                    <p class="mb-0">Lỗi hệ thống (30 ngày)</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card bg-light">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">Hoạt động đăng nhập (7 ngày qua)</h5>
                </div>
                <div class="card-body">
                    <canvas id="loginActivityChart" height="300"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card bg-light">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0">Tỷ lệ lỗi hệ thống (7 ngày qua)</h5>
                </div>
                <div class="card-body">
                    <canvas id="errorRatesChart" height="300"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- System Logs Table -->
    <div class="row">
        <div class="col-12">
            <div class="card bg-light">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0">Nhật ký hệ thống gần đây</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Thời gian</th>
                                    <th>Thông báo lỗi</th>
                                    <th>Mức độ</th>
                                    <th>Trạng thái</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var log in Model.SystemLogs)
                                {
                                    <tr>
                                        <td>@log.Date.ToString("dd/MM/yyyy HH:mm")</td>
                                        <td>
                                            @if (log.Name.Length > 50)
                                            {
                                                <span title="@log.Name">@(log.Name.Substring(0, 50))...</span>
                                            }
                                            else
                                            {
                                                @log.Name
                                            }
                                        </td>
                                        <td>
                                            <span class="badge @(log.Value == "Error" ? "bg-danger" : log.Value == "Warning" ? "bg-warning" : "bg-info")">
                                                @log.Value
                                            </span>
                                        </td>
                                        <td>
                                            <span class="badge @(log.Status == "Critical" ? "bg-danger" : "bg-success")">
                                                @(log.Status == "Critical" ? "Nghiêm trọng" : "Bình thường")
                                            </span>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Login Activity Bar Chart
        const loginCtx = document.getElementById('loginActivityChart').getContext('2d');
        new Chart(loginCtx, {
            type: 'bar',
            data: {
                labels: @Html.Raw(Json.Serialize(Model.LoginActivity.Select(x => x.Label))),
                datasets: [{
                    label: 'Lượt đăng nhập',
                    data: @Html.Raw(Json.Serialize(Model.LoginActivity.Select(x => x.Value))),
                    backgroundColor: 'rgba(54, 162, 235, 0.8)'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Error Rates Line Chart
        const errorCtx = document.getElementById('errorRatesChart').getContext('2d');
        new Chart(errorCtx, {
            type: 'line',
            data: {
                labels: @Html.Raw(Json.Serialize(Model.ErrorRates.Select(x => x.Label))),
                datasets: [{
                    label: 'Số lỗi',
                    data: @Html.Raw(Json.Serialize(Model.ErrorRates.Select(x => x.Value))),
                    borderColor: '#dc3545',
                    backgroundColor: 'rgba(220, 53, 69, 0.1)',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>
}